# Implementation Plan

- [ ] 1. Create database migration and seed initial data
  - Create migration file `migrations/013_contact_management.sql`
  - Define contact_categories table with indexes
  - Define contact_methods table with JSONB config field and indexes
  - Define platform_availability table with indexes
  - Define platform_settings table with indexes
  - Add triggers for updated_at columns on all tables
  - Seed default contact categories (General inquiry, Pricing & sales, Technical support, Billing, Partnership, Other)
  - Seed default contact methods with current hardcoded values from Contact.tsx
  - Seed default availability schedule (Weekdays, Saturday, Sunday with current hours)
  - Seed emergency support text from current Contact page
  - _Requirements: 2.1, 3.1, 4.1, 5.1, 6.1, 7.1_

- [ ] 2. Create backend API routes for contact categories
  - Create `api/routes/contact.ts` for public endpoints
  - Implement GET /api/contact/config endpoint to return all active contact configuration
  - Create `api/routes/admin/contact.ts` for admin endpoints
  - Implement GET /api/admin/contact/categories endpoint with admin authentication
  - Implement POST /api/admin/contact/categories endpoint with validation
  - Implement PUT /api/admin/contact/categories/:id endpoint
  - Implement DELETE /api/admin/contact/categories/:id endpoint
  - Implement POST /api/admin/contact/categories/reorder endpoint for drag-and-drop
  - Add input validation for category label, value, and display_order
  - Add error handling with consistent error responses
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 10.1, 10.3_

- [ ] 3. Create backend API routes for contact methods
  - Implement GET /api/admin/contact/methods endpoint
  - Implement GET /api/admin/contact/methods/:method_type endpoint
  - Implement PUT /api/admin/contact/methods/:method_type endpoint
  - Add validation for email format in email method config
  - Add validation for phone number format in phone method config
  - Add validation for URL format in ticket method dashboard_link
  - Add validation for address fields in office method config
  - Add error handling for invalid method types
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 4. Create backend API routes for platform availability
  - Create `api/routes/admin/platform.ts` for platform settings
  - Implement GET /api/admin/platform/availability endpoint
  - Implement PUT /api/admin/platform/availability endpoint
  - Add validation for day_of_week values
  - Add validation for hours_text format
  - Handle emergency_support_text updates in platform_settings table
  - Add error handling with consistent error responses
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 5. Update Admin.tsx to reorganize navigation structure
  - Add new AdminSection type for 'platform' and 'contact-management'
  - Update ADMIN_SECTIONS array to include new sections
  - Modify sidebar navigation to create "Settings" section with "Platform" subsection
  - Group "Theme", "FAQ Management", and "Contact Management" under Platform
  - Update hash routing to handle /admin#platform and /admin#contact-management
  - Ensure existing Theme and FAQ Management routes still work
  - Add navigation icons for new sections
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 6. Create admin contact category management components
  - Create `src/components/admin/ContactCategoryManager.tsx` component
  - Implement category list with drag-and-drop using @dnd-kit
  - Create category form dialog for create/edit operations
  - Add validation for category label and value fields
  - Implement delete confirmation dialog
  - Add loading states during API operations
  - Add error handling with toast notifications
  - Implement reorder functionality with optimistic UI updates
  - Add visual indicators for active/inactive categories
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 9.1, 9.2, 9.3, 9.4, 9.5, 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ] 7. Create admin contact method management components
  - Create `src/components/admin/ContactMethodManager.tsx` component
  - Create EmailMethodForm with email address and response time fields
  - Create TicketMethodForm with dashboard link and priority queues array
  - Create PhoneMethodForm with phone number and availability text fields
  - Create OfficeMethodForm with multi-line address fields
  - Add toggle switches to enable/disable each method
  - Add validation for email format, phone format, and URL format
  - Implement save functionality for each method type
  - Add loading states during API operations
  - Add error handling with toast notifications
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 8. Create admin platform availability management component
  - Create `src/components/admin/PlatformAvailabilityManager.tsx` component
  - Implement availability schedule form with day-by-day configuration
  - Add toggle switches for open/closed status per day
  - Add text input fields for hours_text per day
  - Add textarea for emergency support text
  - Implement save functionality for availability updates
  - Add loading states during API operations
  - Add error handling with toast notifications
  - Display current availability in a clear table format
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 9. Integrate contact management into Admin.tsx
  - Add 'contact-management' tab to Admin page
  - Import ContactCategoryManager and ContactMethodManager components
  - Create tabs for "Categories" and "Contact Methods"
  - Add 'platform' tab to Admin page
  - Import PlatformAvailabilityManager component
  - Create tabs for "Availability", "Theme", and future settings
  - Ensure proper routing between tabs
  - Add loading states while fetching data
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 9.1_

- [ ] 10. Update public Contact page to use database content
  - Update `src/pages/Contact.tsx` to fetch data from /api/contact/config
  - Replace hardcoded category options with database categories
  - Replace hardcoded email card with database email method
  - Replace hardcoded ticket card with database ticket method
  - Replace hardcoded phone card with database phone method
  - Replace hardcoded office card with database office method
  - Replace hardcoded availability schedule with database availability
  - Add loading state while fetching contact configuration
  - Add error handling with fallback to default content
  - Maintain existing visual design and layout
  - Only render active contact methods
  - Display categories in dropdown ordered by display_order
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 11. Add TypeScript type definitions
  - Create `src/types/contact.ts` file
  - Define ContactCategory interface
  - Define ContactMethod interface with method_type union type
  - Define EmailConfig, TicketConfig, PhoneConfig, OfficeConfig interfaces
  - Define PlatformAvailability interface
  - Define ContactConfig interface for API response
  - Define form data interfaces for admin components
  - Export all types for use across the application
  - _Requirements: All requirements (type safety)_

- [ ] 12. Register new API routes in backend
  - Update `api/app.ts` to import new route files
  - Register /api/contact routes for public endpoints
  - Register /api/admin/contact routes with admin middleware
  - Register /api/admin/platform routes with admin middleware
  - Ensure proper middleware order (auth, rate limiting, etc.)
  - Test route registration with health check
  - _Requirements: All API-related requirements_

- [ ] 13. Run database migration and verify schema
  - Execute migration script: `node scripts/run-migration.js`
  - Verify all tables created successfully
  - Verify indexes created on appropriate columns
  - Verify triggers for updated_at columns work
  - Verify seed data inserted correctly
  - Test querying contact_categories, contact_methods, platform_availability tables
  - _Requirements: 2.1, 3.1, 4.1, 5.1, 6.1, 7.1_

- [ ] 14. Test admin contact management functionality
  - Test creating new contact categories
  - Test editing existing contact categories
  - Test deleting contact categories
  - Test drag-and-drop reordering of categories
  - Test updating email contact method
  - Test updating ticket contact method with priority queues
  - Test updating phone contact method
  - Test updating office contact method
  - Test toggling contact method visibility
  - Test updating availability schedule
  - Test updating emergency support text
  - Verify validation errors display correctly
  - Verify loading states work properly
  - Verify toast notifications appear for success/error
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 4.1, 4.2, 5.1, 5.2, 6.1, 6.2, 7.1, 7.2, 7.3, 9.3, 9.4, 9.5, 10.1, 10.2, 10.3_

- [ ] 15. Test public Contact page with database content
  - Verify contact form dropdown shows database categories in correct order
  - Verify only active contact methods are displayed
  - Verify email method displays correct email address and response time
  - Verify ticket method displays priority queues correctly
  - Verify phone method displays correct phone number
  - Verify office method displays complete address
  - Verify availability schedule displays correct hours
  - Verify emergency support text displays correctly
  - Test fallback behavior when database is empty
  - Verify loading state displays while fetching data
  - Verify error handling when API fails
  - Test responsive design on mobile devices
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 16. Test admin navigation reorganization
  - Verify "Platform" section appears under Settings in sidebar
  - Verify clicking "Theme" navigates to /admin#theme
  - Verify clicking "FAQ Management" navigates to /admin#faq-management
  - Verify clicking "Contact Management" navigates to /admin#contact-management
  - Verify active state indicators work correctly
  - Verify collapsible sections expand/collapse properly
  - Test navigation on mobile devices
  - Verify non-admin users cannot access admin sections
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 17. Verify end-to-end workflow
  - Create a new contact category in admin
  - Verify it appears in public Contact page dropdown
  - Update email contact method in admin
  - Verify changes appear on public Contact page
  - Disable a contact method in admin
  - Verify it no longer appears on public Contact page
  - Update availability schedule in admin
  - Verify changes appear on public Contact page
  - Reorder contact categories in admin
  - Verify new order appears in public Contact page dropdown
  - Test complete user journey from admin changes to public display
  - _Requirements: All requirements (integration testing)_
